<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Deon Roos">

<title>Deon Roos - Structural Topic Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="site_libs/viz-1.8.2/viz.js"></script>
<link href="site_libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="site_libs/grViz-binding-1.0.11/grViz.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Deon Roos</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./courses.html" rel="" target="">
 <span class="menu-text">My Courses</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./explainers.html" rel="" target="">
 <span class="menu-text">Stats Explainers</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./publications.html" rel="" target="">
 <span class="menu-text">My Output</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./cv.html" rel="" target="">
 <span class="menu-text">My CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./blog/index.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
  <li><a href="#why-analyse-text" id="toc-why-analyse-text" class="nav-link active" data-scroll-target="#why-analyse-text">Why analyse text?</a>
  <ul class="collapse">
  <li><a href="#what-is-a-structural-topic-model" id="toc-what-is-a-structural-topic-model" class="nav-link" data-scroll-target="#what-is-a-structural-topic-model">What is a Structural Topic Model?</a></li>
  <li><a href="#but-how-do-they-work" id="toc-but-how-do-they-work" class="nav-link" data-scroll-target="#but-how-do-they-work">But how do they work?</a></li>
  </ul></li>
  <li><a href="#what-does-it-look-like" id="toc-what-does-it-look-like" class="nav-link" data-scroll-target="#what-does-it-look-like">What does it look like?</a>
  <ul class="collapse">
  <li><a href="#mathematical-formulation" id="toc-mathematical-formulation" class="nav-link" data-scroll-target="#mathematical-formulation">Mathematical formulation</a></li>
  <li><a href="#structural-topic-models-explained-video" id="toc-structural-topic-models-explained-video" class="nav-link" data-scroll-target="#structural-topic-models-explained-video">Structural Topic Models Explained (Video)</a></li>
  <li><a href="#load-packages-and-data" id="toc-load-packages-and-data" class="nav-link" data-scroll-target="#load-packages-and-data">Load Packages and Data</a></li>
  <li><a href="#preprocess-text" id="toc-preprocess-text" class="nav-link" data-scroll-target="#preprocess-text">Preprocess Text</a></li>
  <li><a href="#choosing-k-number-of-topics" id="toc-choosing-k-number-of-topics" class="nav-link" data-scroll-target="#choosing-k-number-of-topics">Choosing K (Number of Topics)</a></li>
  <li><a href="#fit-stm-model-1-no-covariates" id="toc-fit-stm-model-1-no-covariates" class="nav-link" data-scroll-target="#fit-stm-model-1-no-covariates">Fit STM – Model 1 (No Covariates)</a></li>
  <li><a href="#fit-stm-model-2-with-covariates" id="toc-fit-stm-model-2-with-covariates" class="nav-link" data-scroll-target="#fit-stm-model-2-with-covariates">Fit STM – Model 2 (With Covariates)</a></li>
  <li><a href="#estimate-and-plot-covariate-effects" id="toc-estimate-and-plot-covariate-effects" class="nav-link" data-scroll-target="#estimate-and-plot-covariate-effects">Estimate and Plot Covariate Effects</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Structural Topic Models</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Deon Roos </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p>Hey Grace, this page has been written especially for you. I’ve tried to write the material here to help cover the underlying theory of STMs as well as how to actually <em>implement</em> them. But be warned, the theory here is tough and I’m new to this myself. It took me a good while to make sense of the stats here, so be patient with yourself (and me). This page is not intended to be your “supervisor” - I’m still here to help you. Instead, it’s intended to be a stand alone document you can always come back to whenever you need.</p>
<p>Hopefully this page helps you understand the method and is useful, but let me know if you have any doubts. It’s unlikely that this walk through will answer every bit of confusion you have so I won’t take any offence if you want to burn this in a giant pyre. Just tell me.</p>
<hr>
<section id="why-analyse-text" class="level1">
<h1>Why analyse text?</h1>
<p>Let’s say we want to understand how movie critic reviews have changed over time. How would we do this. Well, you say, maybe the “simplest” way is simply to read thousands of critic reviews over 50 years and try to summarise this ourselves. That’s damned hard but do-able. That’s what a lot of arts PhD students do. I’d argue I’m not smart enough to do that, so I want to cheat and use computers to do it for me.</p>
<p>But how do we do that?</p>
<p>This is where you are moving into a murky area; somewhere between statistics and machine learning (I’m not entirely sure where STM falls in this regard).</p>
<p>One option is to use <em>supervised</em> learning. This is where you specify a goal and try to achieve it. For example, in BI3010, you learnt how to do <em>supervised</em> learning using linear models:</p>
<p><span class="math display">\[
y_i \sim Normal(\mu_i, \sigma) \\
\mu_i = \beta_0 + \beta_1 \times x_i
\]</span></p>
<p>Here our goal was to learn <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span>. This is described as <em>supervised</em> because we have told the computer what it should learn; “learn these straight line parameters”.</p>
<p>To do this with text would require that you sit down and label each document that comes across your desk at being “Pro-Lynx” or “Anti-Lynx”. Again, do-able, but that doesn’t seem like much of an upgrade compared to the first arts PhD option.</p>
<p>The last option is <em>unsupervised</em> learning. In contrast with <em>supervised</em>, we don’t have a goal <em>per se</em> here. Instead, our goal is to <em>discover</em> the goal. What that means is that we are going to use an algorithm to discover themes and patterns in the text that we did not know to look for. Our job is to interpret these results; What does the first theme actually mean? That’s much easier than trying to identify the theme ourselves!</p>
<p>There are no shortage of options available out there to do this, but the one you’ll use in your thesis is called Structural Topic Modelling.</p>
<section id="what-is-a-structural-topic-model" class="level2">
<h2 class="anchored" data-anchor-id="what-is-a-structural-topic-model">What is a Structural Topic Model?</h2>
<p>A <em>Structural Topic Model (STM)</em> is a type of analysis that allows us to explore large sets of text documents and identify what the common themes are; called <em>topics</em>. Just like you did in BI3010, you can also include covariates (also called explanatory variables) to say why you think a topic may be more or less prevalent over time.</p>
<blockquote class="blockquote">
<p><strong>Grace</strong>, in your case, this might include things like how date (i.e.&nbsp;how has coverage of lynx changed over time), and if the illegal release of lynx (and maybe their interaction) may have changed which topics are more or less prevelant. For example, <em>did negative topics become more common in the media after the illegal release compared to before</em>?</p>
</blockquote>
<p>STMs are a fairly complex beast. There are lots of elements that we could cover. One that I won’t touch on much here is <em>Bayesian</em> statistics. I have written another set of <a href="https://deonroos.github.io/Occupancy_Modelling/Bayesian_Statistics.html">documents</a> that explain the general theory of this, which you are welcome to see. Although STMs, as implemented in the <code>R</code> package <code>stm</code>, use the <em>Bayesian</em> statistical framework, you can’t actually interact with it, so it’s not crucial to understand in this case. However, I would recommend trying to wrap your head around it, as it’s a piece of knowledge that may make you highly employable.</p>
<p>Structural Topic Models make the following key assumptions:</p>
<ul>
<li><p>Each <em>document</em> (e.g., a newspaper article) is a <em>mixture of topics</em>, with each topic contributing to the document in a proportion.<br>
<em>Example</em>: A particular article might be 90% about “lynx are good” and 5% about “lynx are bad”</p></li>
<li><p>Each <em>word</em> in the document is associated with one of these topics.<br>
<em>Example</em>: If a word belongs to the topic “lynx are bad”, it is more likely to be something like “kill”, “predator”, or “livestock”. The probabilty for topic-specific word contribute to create an entire distribution of probabilities for all words used in a topic. Collectively, topic-words are referred to as <em>content</em>.</p></li>
</ul>
<p>Thus, each <em>topic</em> has a characteristic <em>distribution over words</em>, e.g., topic 3 might have a 30% chance of using “kill”, 25% chance of “livestock”, and only 0.5% for “natural”.</p>
<p>So our objective then, is to identify different <em>topics</em>, and which words tend to categorise those topics. This is what we’re, fundamentally, trying to do in an STM.</p>
</section>
<section id="but-how-do-they-work" class="level2">
<h2 class="anchored" data-anchor-id="but-how-do-they-work">But how do they work?</h2>
<p>Mechanically, an STM works as follows:</p>
<ol type="1">
<li><p>For each document <span class="math inline">\(d\)</span>, estimate the <em>latent</em> topic prevalences (<em>latent</em> just means something we cannot observe, i.e.&nbsp;there’s no label on a newspaper article that says “This is Pro-Lynx”, we have to estimate that from data). We do this by using a <span class="math inline">\(logistic\)</span> <span class="math inline">\(normal\)</span> distribution, whose mean is determined by document-level covariates (basically through a GLM).</p></li>
<li><p>Convert these <em>latent</em> prevalences into a topic proportion vector <span class="math inline">\(\theta_d\)</span> via a softmax transformation (i.e., normalizing onto the simplex).</p></li>
<li><p>For each word <span class="math inline">\(w_{d,n}\)</span> in the document:</p>
<ul>
<li><p>Estimate which <em>topic</em> to assign it to using <span class="math inline">\(z_{d,n} \sim \text{Categorical}(\theta_d)\)</span> (another GLM)</p></li>
<li><p>Then, given the topic <span class="math inline">\(z_{d,n}\)</span>, estimate the word from that topic’s word distribution <span class="math inline">\(\beta{z_{d,n}}\)</span></p></li>
</ul></li>
</ol>
<p>That’s only 5 bullet points and it made my head spin multiple times the first time I read it. By the time I wrote it (and re-wrote it multiple times to try and make it make sense) my head was doing cartwheels. It sounds horrible. It reads horribly. But in truth, it’s not <em>that</em> bad. I genuinely believe you can wrap your head around it without any cartwheels.</p>
</section>
</section>
<section id="what-does-it-look-like" class="level1">
<h1>What does it look like?</h1>
<p>One way to visualise an STM is by using <em>plate notation</em>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DiagrammeR)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">grViz</span>(<span class="st">"</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="st">digraph stm {</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="st">  graph [layout = dot, rankdir = LR]</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="st">  # Nodes</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="st">  Σ [shape=circle, label='Σ', style=dashed]</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="st">  γ [shape=circle, label='γ', style=dashed]</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="st">  X [shape=circle, label='X']</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="st">  Y [shape=circle, label='Y']</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="st">  θ [shape=circle, label='θ', style=dashed]</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="st">  z [shape=circle, label='z', style=dashed]</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="st">  w [shape=circle, label='w']</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="st">  β [shape=circle, label='β', style=dashed]</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="st">  # Edges</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="st">  Σ -&gt; θ</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="st">  γ -&gt; θ</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="st">  X -&gt; θ</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="st">  θ -&gt; z</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="st">  z -&gt; w</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="st">  β -&gt; w</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="st">  Y -&gt; β</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="st">  # Outer plate: D</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="st">  subgraph cluster_D {</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="st">    label = 'D'</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="st">    style = 'solid'</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="st">    X; θ; β; Y;</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="st">    # Nested plate: N</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="st">    subgraph cluster_N {</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="st">      label = 'N'</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="st">      style = 'solid'</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="st">      z; w;</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="grViz html-widget html-fill-item" id="htmlwidget-8c460f9579ec2e7d3994" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-8c460f9579ec2e7d3994">{"x":{"diagram":"\ndigraph stm {\n  graph [layout = dot, rankdir = LR]\n\n  # Nodes\n  Σ [shape=circle, label=\"Σ\", style=dashed]\n  γ [shape=circle, label=\"γ\", style=dashed]\n  X [shape=circle, label=\"X\"]\n  Y [shape=circle, label=\"Y\"]\n  θ [shape=circle, label=\"θ\", style=dashed]\n  z [shape=circle, label=\"z\", style=dashed]\n  w [shape=circle, label=\"w\"]\n  β [shape=circle, label=\"β\", style=dashed]\n\n  # Edges\n  Σ -> θ\n  γ -> θ\n  X -> θ\n  θ -> z\n  z -> w\n  β -> w\n  Y -> β\n\n  # Outer plate: D\n  subgraph cluster_D {\n    label = \"D\"\n    style = \"solid\"\n    X; θ; β; Y;\n\n    # Nested plate: N\n    subgraph cluster_N {\n      label = \"N\"\n      style = \"solid\"\n      z; w;\n    }\n  }\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Where:</p>
<ul>
<li><p><em>Nodes</em>: Circles represent variables. Dashed circles mean they are <em>latent</em> (a variable we have to estimate), while solid circles are observed data.</p></li>
<li><p><em>Plates</em>: Rectangle indicate repetition:</p>
<ul>
<li><p><span class="math inline">\(D\)</span>: For each document</p></li>
<li><p><span class="math inline">\(N\)</span>: For each word in a document</p></li>
</ul></li>
</ul>
<p>And where the variables in the plate notation are:</p>
<ul>
<li><p><span class="math inline">\(X\)</span> - Document level covariates (e.g.&nbsp;date of publication, political leaning)</p></li>
<li><p><span class="math inline">\(\alpha\)</span> - The regression coefficients for the mean of the logistic normal</p></li>
<li><p><span class="math inline">\(\mu\)</span> - The mean <em>vector</em> for the multivariate normal (logit-scale topic propensities)</p></li>
<li><p><span class="math inline">\(\Sigma\)</span> - The <em>covariance</em> <em>matrix</em> between topics (models topic co-occurence)</p></li>
<li><p><span class="math inline">\(z_d\)</span> - Latent logit-scale topic propensity for document <span class="math inline">\(d\)</span></p></li>
<li><p><span class="math inline">\(\theta\)</span> - Topic proportions for a document (which sums to 1)</p></li>
<li><p><span class="math inline">\(z_{d,n}\)</span> - Topic assignment for word <span class="math inline">\(n\)</span> in document <span class="math inline">\(d\)</span></p></li>
<li><p><span class="math inline">\(w_{d,n}\)</span> - The observed word</p></li>
<li><p><span class="math inline">\(\beta_k\)</span> - Word distribution (categorical) for topic <span class="math inline">\(k\)</span>.</p></li>
</ul>
<p>Here’s what that looks like in a less “stats” way and with a few details omitted (also apologies for the generative AI image):</p>
<p><img src="media/lynx_stm.png" class="img-fluid"></p>
<section id="mathematical-formulation" class="level2">
<h2 class="anchored" data-anchor-id="mathematical-formulation">Mathematical formulation</h2>
<p>The core structure of an STM is:</p>
<p><span class="math display">\[
\begin{aligned}
\eta_d &amp;\sim \mathcal{MVNorm}(X_d \Gamma, \Sigma) \\
\theta_d &amp;= \text{softmax}(\eta_d) \\
z_{d,n} &amp;\sim \text{Categorical}(\theta_d) \\
w_{d,n} &amp;\sim \text{Categorical}(\beta_{z_{d,n}}) \\
\beta_{k,v} \propto \exp\left( m_v + \kappa_{k,v}^{(\text{topic})} + \kappa_{g,v}^{(\text{cov})} + \kappa_{k,g,v}^{(\text{int})} \right) \\
\end{aligned}
\]</span></p>
<p><span class="math inline">\(\eta_d\)</span> is a <em>latent</em> vector of logit-scale topic propensities for document <span class="math inline">\(d\)</span>, drawn from a multivariate normal distribution with mean <span class="math inline">\(X_d\Gamma\)</span> and covariance <span class="math inline">\(\Sigma\)</span>. (Rather than there being a single conditional mean like in a <span class="math inline">\(Normal\)</span> linear model, here <span class="math inline">\(X_d\Gamma\)</span> is a column, or <em>vector</em> of means, one for each document).</p>
<p><span class="math inline">\(\theta_d\)</span> is the topic proportion <em>vector</em> for document <span class="math inline">\(d\)</span>, obtained by applying a softmax transformation to <span class="math inline">\(\eta_d\)</span>. All entries are non-negative and sum to 1.</p>
<p><span class="math inline">\(z_{d,n}\)</span> is the <em>latent</em> topic assignment for word <span class="math inline">\(n\)</span> in document <span class="math inline">\(d\)</span>, drawn from a categorical distribution with probabilities <span class="math inline">\(\theta_d\)</span>.</p>
<p><span class="math inline">\(w_{d,n}\)</span> is the actual observed word, drawn from the categorical distribution <span class="math inline">\(\beta_z_{d,n}\)</span>, i.e., from the word distribution corresponding to the assigned topic.</p>
<p><span class="math inline">\(\beta\)</span> is the topic–word matrix, of dimension <span class="math inline">\(\mathbf{K}\times \mathbf{V}\)</span>, where each row <span class="math inline">\(\beta_k\)</span> is a probability distribution over the vocabulary (words) for topic <span class="math inline">\(k\)</span> (each row in the <span class="math inline">\(\beta\)</span> matrix below). <span class="math inline">\(\beta\)</span> can be estimated from the data or modeled as a logit-linear function of content covariates.</p>
<p>For <span class="math inline">\(\beta\)</span> it’s actually a topic-word matrix <span class="math inline">\(\beta\)</span>: <span class="math inline">\(\mathbf{K} \times \mathbf{V}\)</span></p>
<p><span class="math display">\[
\begin{array}{c|cccc}
&amp; \text{predator} &amp; \text{policy} &amp; \cdots &amp; \text{illegal} \\
\hline
\text{Topic } 1 &amp; \beta_{1,1} &amp; \beta_{1,2} &amp; \cdots &amp; \beta_{1,V} \\
\text{Topic } 2 &amp; \beta_{2,1} &amp; \beta_{2,2} &amp; \cdots &amp; \beta_{2,V} \\
\text{Topic } 3 &amp; \beta_{3,1} &amp; \beta_{3,2} &amp; \cdots &amp; \beta_{3,V} \\
\vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
\text{Topic } K &amp; \beta_{K,1} &amp; \beta_{K,2} &amp; \cdots &amp; \beta_{K,V}
\end{array}
\]</span></p>
<p>And for <span class="math inline">\(\theta\)</span>, it’s a document-topic matrix: <span class="math inline">\(\mathbf{D} \times \mathbf{K}\)</span></p>
<p><span class="math display">\[
\begin{array}{c|cccc}
&amp; \text{Topic 1} &amp; \text{Topic 2} &amp; \cdots &amp; \text{Topic } K \\
\hline
Doc1 &amp; \theta_{1,1} &amp; \theta_{1,2} &amp; \cdots &amp; \theta_{1,K} \\
Doc2 &amp; \theta_{2,1} &amp; \theta_{2,2} &amp; \cdots &amp; \theta_{2,K} \\
Doc3 &amp; \theta_{3,1} &amp; \theta_{3,2} &amp; \cdots &amp; \theta_{3,K} \\
\vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
D &amp; \theta_{D,1} &amp; \theta_{D,2} &amp; \cdots &amp; \theta_{D,K}
\end{array}
\]</span></p>
</section>
<section id="structural-topic-models-explained-video" class="level2">
<h2 class="anchored" data-anchor-id="structural-topic-models-explained-video">Structural Topic Models Explained (Video)</h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/3kcjbzy4UPM?start=828" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="">
</iframe>
<hr>
</section>
<section id="load-packages-and-data" class="level2">
<h2 class="anchored" data-anchor-id="load-packages-and-data">Load Packages and Data</h2>
<div class="cell" data-hash="stm-explainer_cache/html/load-packages_7497116084cbd4aef6fa2d84f5504ad1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>stm v1.3.7 successfully loaded. See ?stm for help. 
 Papers, resources, and other materials at structuraltopicmodel.com</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: NLP</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'ggplot2'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:NLP':

    annotate</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/poliblogs2008.csv"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Display just the first few rows</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  X
1 1
2 2
3 3
4 4
5 5
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    documents
1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       After a week of false statements, lies, and dismissive apologies, Pakistani President Pervez Musharraf now says that he is disatisfied with the probe into former Prime Minister Benazir Bhutto's death and is asking Scotland Yard for help:"One should not give a statement that's 100 percent final. That's the flaw that we suffer from," Musharraf said at a news conference, noting that more evidence was emerging about the attack. "We needed more experience, maybe more forensic and technical experience that our people don't have. Therefore I thought Scotland Yard may be more helpful." Musharraf said he also reached out to British investigators for assistance to dispel accusations that Pakistan's military or intelligence services were involved. "We don't mind going to any extent, as nobody is involved from the government or agency side," he said. Speaking a week after Bhutto's assassination in a shooting and suicide bombing, Musharraf denied there had been a security lapse and implied that Bhutto, who was greeting supporters through the sunroof of her armored vehicle at the time of the attack, was partly responsible. "Who is to be blamed for her coming out (of) her vehicle?" he asked, adding that others in the vehicle had not been hurt in the attack.When in doubt, blame the victim.Reports in the immediate aftermath of the bombing said that as far back as November, Bhutto believed Musharraf was deliberately withholding security forces that could have made her safer. Unless he feared Bhutto more than the street riotors, I doubt whether that was really true. More likely, he didn't trust the army to protect her. And when she requested that Musharraf allow her to use western private security firms, he refused.I don't think Musharraf wanted Bhutto dead. But I think he is just too weak and indecisive to have done what was needed to protect her.
2 I honestly don't know how either party's caucus results will play out tonight. Usually, you can get a good idea of&nbsp;perhaps not a winner but at least you can figure out who's up, who's down, and who's on life support.Not with the Iowa Caucuses. Races in both parties are just too close to call. So many variables. So much&nbsp;volatility among the voters. And the polls are whacky.As an example, here are the final two polls out on Iowa. First, ARG:Mike Huckabee 29% (23%) Mitt Romney 24% (32%) Fred Thompson 13% (7%) John McCain 11% (11%) Rudy Giuliani 8% (6%) Ron Paul 6% (6%) Duncan Hunter 4% (2%) Undecided 4% (11%) (Number in parentheses is from ARG survey taken&nbsp;last week)The spread between Huckabee and Romney is the margin of error which means they are virtually tied. Note Thompson's huge bump. Is he surging? Many think so although he probably doesn't have enough juice to catch either front runner for second place. But a strong third sends him along the campaign trail - despite what you might have heard about him dropping out.&nbsp;(Fred and his staff are denying the filthy rumor every chance they get.)Meanwhile, Zogby's daily tracking poll (three day rolling average) tells a little different story:* Huckabee - 31%* Romney - 25%* Thompson - 11%*McCain -10%Here the Huckster opens up a slight lead on Romney with Thompson and McCain far back in the pack.On the Democratic side, Obama has sprinted into the lead:Democrat Barack Obama continued his upward momentum through the evening before the Iowa caucuses, capturing the lead ahead of rivals John Edwards and Hillary Clinton.. Meanwhile, Republican Mike Hucakbee widened his lead over Mitt Romney down the stretch, the newest and last Reuters/C–SPAN/Zogby daily telephone tracking poll in Iowa shows. Obama broke through the 30% barrier for the first time, gaining 31% support after another strong day leading up to the caucuses. But more dramatic was Clinton’s four-point drop in this last day of tracking. Edwards moved into second place by himself after another day where he steadily gained ground. This fifth and final daily tracking poll was conducted using live telephone operators in the Zogby call center in Upstate New York. Edwards finished this Zogby daily tracking in Iowa in the same place as four years ago, when Zogby correctly identified the finishing order of the candidates in that caucus.Hillary Clinton has been playing down her chances the last 48 hours and could very well finish 3rd.All of this matters little in the end. The process of caucusing is complicated for the Democrats and it is possible for any of the top three candidates to win or come in third.We'll see by midnight tonight central time.
3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          While we stand in awe of the willingness of our troops in Iraq to sacrifice themselves for the Nation, the fewer that are required to do so, the better.&nbsp; And the news on that front is good.&nbsp; As can be seen in the chart below, our military deaths in December&nbsp;dropped to 23 from 37 in November.&nbsp; December deaths are down over 80% (82%) from May's peak this year of 126.&nbsp; Assuming this reflects a permanent change in the correlation of forces in Iraq - and it is likely that it does, although we cannot be certain of it - it reflects a tremendous achievement on the part of General Petraeus, since this is the result not of retreating from our objectives in Iraq but of advancing toward them - of executing the mission.What of Iraqi deaths?&nbsp; Iraqi security forces and civilian fatalities are also down in December from November.&nbsp;Iraqi deaths are down only by a small amount - from 560 in November to 534 in December, although that difference is not small if you are one of the ones who are now still alive.&nbsp; And the decline from this year's peak in February of 3,014 is a drop of 82%(!).Are we out of the woods in Iraq?&nbsp; It would seem not.&nbsp; We have General Odierno's estremely disturbing cri de coeur&nbsp; at the end of November, which we can assume was endorsed by his chief, General Petraeus.&nbsp; So far as we know, General Odierno's point "A window of opportunity has opened for the government to reach out to its former foes, said Army Lt. Gen. Raymond T. Odierno, the commander of day-to-day U.S. military operations in Iraq, but ‘it's unclear how long that window is going to be open.'"has not been resolved.&nbsp; While some economic indicators, such as the Iraq Stock Exchange and the value of the Iraqi dinar, are showing real strength, the status of the estimated 4 million internal and external refugees remains open, as does the high unemployment rate, estimated at over 40%.&nbsp; But the fatalities figures are good news on the war-fighting front and we don't want to miss them.&nbsp; Success doesn't always announce itself.&nbsp;&nbsp; It's important not to miss it when it is achieved.
4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                These pages recently said goodbye to global warming.&nbsp;&nbsp;Ironically, the current spell of global warming, such as it is, can be expected to end just as the Kyoto treaty ends in 2012, but having nothing to do with reduced emissions from fossil fuels.&nbsp; For the remainder of this century, it will be global cooling we'll have to worry about, according to highly credentialed Russian scientist, Dr. Oleg Sorokhtin.Dr. Sorokhtin, Merited Scientist of Russia and fellow of the Russian Academy of Natural Sciences, is staff researcher of the Oceanology Institute.&nbsp; He explains the recent warming as a natural trend."Earth is now at the peak of one of its passing warm spells. It started in the 17th century when there was no industrial influence on the climate to speak of and no such thing as the hothouse effect. The current warming is evidently a natural process and utterly independent of hothouse gases."So what will happen in the future?"Astrophysics knows two solar activity cycles, of 11 and 200 years. Both are caused by changes in the radius and area of the irradiating solar surface. The latest data, obtained by Habibullah Abdusamatov, head of the Pulkovo Observatory space research laboratory, say that Earth has passed the peak of its warmer period, and a fairly cold spell will set in quite soon, by 2012. Real cold will come when solar activity reaches its minimum, by 2041, and will last for 50-60 years or even longer."Physical and mathematical calculations predict a new Ice Age. It will come in 100,000 years, at the earliest, and will be much worse than the previous. Europe will be ice-bound, with glaciers reaching south of Moscow."The high standing of Dr. Sorkhtin and the inherent plausibility of his argument that climate will continue to follow the same basic causal factor, solar activity, make this another heavy blow to the heavy breathing of the global warming alarmists, who insist there is no argument at all.
5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       A US report shows how the enemy controlled the information on the battlefield in Fallujah and used this to force the US and Iraqi forces out, in the first battle there. The Belmont&nbsp;Club points out UPI coverage of the report by Shaun Waterman. Here is how the enemy worked: First they kidnapped reporters from major Western news sources, driving them out of the city, and leaving&nbsp;only Al Jazeera, Al Arabiya&nbsp;and local stringers controlled by the enemy as the sole&nbsp;sources of news.&nbsp;When the US returned with many embedded journalists and cut the enemy's information monopoly we won.These figures demonstrate how the insurgency purposely drove the press from the field to recreate the information monopoly they found so advantageous in the opening days of the First Fallujah, when only journalists from Al Jazeera and Al Arabiya were reporting from the scene. The kidnapping campaign compelled news outlets to rely on stringers who could then be controlled by the insurgency and who could be counted on to miraculously stumble on photo opportunities showing insurgents in action, such as the Pulitzer Prize winning photograph of an Iraqi election worker being killed on Haifa Street. The effective riposte again turned out to be finding ways to break the reportorial stranglehold the enemy had established. The information blockade runners turned out to be bloggers and journalists embedded in the military, of whom Michael Yon is perhaps the most famous. The Iraqi bloggers were protected by their anonymity and the embedded journalists were protected by coalition troops. These reporters outflanked the wall of "access journalism" which was gradually restricting the majors and created alternative sources of reportage. Although few in number these blockade runners played a pivotal role in penetrating the "bodyguard of lies" with which al-Qaeda and the Sunni insurgency had surrounded itself.
           docname       rating day blog
1 at0800300_1.text Conservative   3   at
2 at0800300_2.text Conservative   3   at
3 at0800300_3.text Conservative   3   at
4 at0800300_4.text Conservative   3   at
5 at0800300_5.text Conservative   3   at</code></pre>
</div>
</div>
<hr>
</section>
<section id="preprocess-text" class="level2">
<h2 class="anchored" data-anchor-id="preprocess-text">Preprocess Text</h2>
<div class="cell" data-hash="stm-explainer_cache/html/preprocess-text_75652b1a63d2a9b2a48a070431f12180">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>processed <span class="ot">&lt;-</span> <span class="fu">textProcessor</span>(data<span class="sc">$</span>documents, <span class="at">metadata =</span> data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Building corpus... 
Converting to Lower Case... 
Removing punctuation... 
Removing stopwords... 
Removing numbers... 
Stemming... 
Creating Output... </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">prepDocuments</span>(processed<span class="sc">$</span>documents, processed<span class="sc">$</span>vocab, processed<span class="sc">$</span>meta)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Removing 83198 of 123990 terms (83198 of 2298953 tokens) due to frequency 
Your corpus now has 13246 documents, 40792 terms and 2215755 tokens.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>docs <span class="ot">&lt;-</span> out<span class="sc">$</span>documents</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>vocab <span class="ot">&lt;-</span> out<span class="sc">$</span>vocab</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>meta <span class="ot">&lt;-</span> out<span class="sc">$</span>meta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="stm-explainer_cache/html/plot-removed_069f61196cac09cf54a30b7c697d7ab1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotRemoved</span>(processed<span class="sc">$</span>documents, <span class="at">lower.thresh =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">200</span>, <span class="at">by =</span> <span class="dv">100</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="stm-explainer_files/figure-html/plot-removed-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
</section>
<section id="choosing-k-number-of-topics" class="level2">
<h2 class="anchored" data-anchor-id="choosing-k-number-of-topics">Choosing K (Number of Topics)</h2>
<div class="cell" data-hash="stm-explainer_cache/html/choose-k_4e11f06a074f9a7d9d8c08624bbf220c">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># searchK(docs, vocab, K = c(10, 15, 20, 25), data = meta)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Expectation-Maximiation equivalent to brute forcing MCMC - give it a function and iteratively optimise it until threshold of error reached. Priors locked (I think)</p>
<hr>
</section>
<section id="fit-stm-model-1-no-covariates" class="level2">
<h2 class="anchored" data-anchor-id="fit-stm-model-1-no-covariates">Fit STM – Model 1 (No Covariates)</h2>
<div class="cell" data-hash="stm-explainer_cache/html/model1_7dd1f20d3631e3e0696beb67d2ff1ad0">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">stm</span>(<span class="at">documents =</span> docs,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">vocab =</span> vocab,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">K =</span> <span class="dv">20</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> meta,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">init.type =</span> <span class="st">"Spectral"</span>, </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="explore-model-1" class="level3">
<h3 class="anchored" data-anchor-id="explore-model-1">Explore Model 1</h3>
<div class="cell" data-hash="stm-explainer_cache/html/model1-explore_a4a9cb4a85e8550c6abdbbc68922d9db">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model1, <span class="at">type =</span> <span class="st">"summary"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="stm-explainer_files/figure-html/model1-explore-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">labelTopics</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Topic 1 Top Words:
     Highest Prob: democrat, republican, senat, vote, bill, hous, gop 
     FREX: chambliss, bachmann, aye, hagan, merkley, saxbi, reid 
     Lift: “harm”, “mandate”, aderholt, alcivar, altmir, anti-incumb, aronoff 
     Score: aye, republican, gop, senat, dem, rep, reid 
Topic 2 Top Words:
     Highest Prob: citi, immigr, group, organ, state, illeg, new 
     FREX: usmc, open-bord, berkeley, cpl, immigr, mexican, san 
     Lift: -term, “unwelcom, academy”, anti-bord, anti-illeg, anti-troop, backdown 
     Score: usmc, immigr, cpl, chicago, berkeley, citi, counti 
Topic 3 Top Words:
     Highest Prob: obama, democrat, poll, voter, state, vote, hillari 
     FREX: superdeleg, deleg, primari, poll, pennsylvania, michigan, carolina 
     Lift: bredesen, cfi, fine-grain, keeter, margin--error, match-up, mccaskill’ 
     Score: poll, hillari, obama, mccain, voter, deleg, clinton 
Topic 4 Top Words:
     Highest Prob: iran, israel, nuclear, state, iranian, foreign, will 
     FREX: hama, palestinian, ahmadinejad, gaza, khalidi, isra, iaea 
     Lift: iaea, ‘averag, ‘diplomat, ’jad, “contacts”, “diplomaci, “failed” 
     Score: iran, israel, iranian, hama, isra, nuclear, palestinian 
Topic 5 Top Words:
     Highest Prob: oil, energi, price, global, will, drill, warm 
     FREX: ethanol, drill, emiss, arctic, carbon, offshor, climat 
     Lift: dioxid, opec, -cost, -fold, -zero, ‘clean, ‘coal 
     Score: oil, drill, energi, price, gas, global, climat 
Topic 6 Top Words:
     Highest Prob: media, news, time, stori, report, new, press 
     FREX: corsi, enquir, drudg, bias, outlet, blogger, coverag 
     Lift: --fold, ‘barack, “attack”, “colorless”, “coolest, “corrupt”, “docil 
     Score: media, drudg, fox, coverag, o’reilli, eastern, journalist 
Topic 7 Top Words:
     Highest Prob: obama, campaign, barack, clinton, senat, hillari, said 
     FREX: barack, obama, illinoi, axelrod, camp, clinton, team 
     Lift: -watch, “transformational”, accommodationist, addedso, anti-lieberman, anti-nafta, asc 
     Score: obama, hillari, barack, clinton, campaign, senat, chicago 
Topic 8 Top Words:
     Highest Prob: court, vote, will, state, elect, right, voter 
     FREX: qur’, sura, scalia, muhammad’, kathir, court’, allah 
     Lift: pharaoh’, ---vote, --vote, -fault, -judg, -next, -suddi 
     Score: qur’, franken, sura, ballot, muhammad, allah, court 
Topic 9 Top Words:
     Highest Prob: mccain, john, palin, campaign, mccain’, biden, said 
     FREX: palin, scheunemann, fiorina, wasilla, sarah, biden, scriptalreadyrequest 
     Lift: ‘bridg, ‘poor, ‘respect’, “bubbl, “deference”, “embarrassing”, “gotcha 
     Score: mccain, palin, mccain’, biden, sarah, alaska, palin’ 
Topic 10 Top Words:
     Highest Prob: investig, report, law, depart, state, attorney, administr 
     FREX: siegelman, mukasey, kbr, prosecutor, wiretap, attorney, investig 
     Lift: fitzpatrick, renzi’, goodl, kbr, -apr-, -feb-, -mar- 
     Score: blagojevich, attorney, investig, rezko, mukasey, prosecutor, justic 
Topic 11 Top Words:
     Highest Prob: financi, crisi, market, bank, bailout, hous, mortgag 
     FREX: mae, paulson, fanni, loan, aig, waterboard, lender 
     Lift: “counseling”, “ineffective”, “predatori, “tick, “victims”, “waterboard, “week” 
     Score: mortgag, bailout, fanni, paulson, loan, freddi, mae 
Topic 12 Top Words:
     Highest Prob: black, wright, ayer, polit, church, women, one 
     FREX: hage, sermon, dohrn, wright, pfleger, jeremiah, wright’ 
     Lift: “homosexu, “uppity”, abstin, addedthes, aera, afro-centr, afrocentr 
     Score: wright, ayer, church, pastor, cathol, jeremiah, abort 
Topic 13 Top Words:
     Highest Prob: iraq, iraqi, troop, war, militari, forc, will 
     FREX: petraeus, baghdad, maliki, sadr, basra, timet, georgian 
     Lift: ‘zone, “afghanistan, “ambiguous”, “aspir, “aspirational”, “fragile”, “grim” 
     Score: iraqi, iraq, troop, maliki, sadr, afghanistan, taliban 
Topic 14 Top Words:
     Highest Prob: get, like, one, want, ’re, doesn’t, don’t 
     FREX: maverick’, ’ll, doesn’t, won’t, isn’t, can’t, didn’t 
     Lift: --one, ‘cuda, ‘cuda’, “bore, “bunker, “chair”, “christian 
     Score: obama’, ’re, ’ll, doesn’t, romney, didn’t, don’t 
Topic 15 Top Words:
     Highest Prob: bush, presid, said, hous, white, administr, say 
     FREX: bush’, perino, mcclellan, thinkfast, cheney’, feith, fratto 
     Lift: perino, -defens, -growth, ‘’d, ‘appeasement’, ‘axi, ‘becom 
     Score: bush, perino, bush’, rove, cheney, r-az, mcclellan 
Topic 16 Top Words:
     Highest Prob: think, like, dont, peopl, say, know, get 
     FREX: digbi, dont, there, theyr, isnt, doesnt, hes 
     Lift: aboutdigbi, billdigbi, caligula, cest, changebi, digbybob, digbyjan 
     Score: dont, hes, linktocommentspostcount, postcounttb, that, there, doesnt 
Topic 17 Top Words:
     Highest Prob: tax, will, economi, plan, spend, million, econom 
     FREX: tax, health, spend, incom, budget, unemploy, economi 
     Lift: -compet, -teach, ‘strong’, ‘tax, ‘wast, ‘wealthy’, “‘read 
     Score: tax, economi, billion, health, econom, insur, recess 
Topic 18 Top Words:
     Highest Prob: tortur, attack, terrorist, said, kill, polic, use 
     FREX: taser, colombian, ivin, tortur, detaine, anthrax, guantanamo 
     Lift: -sahab, ahmadi, al-iraqi, al-libi, amina, ashraf, attackupd 
     Score: tortur, taser, detaine, interrog, polic, guantanamo, terrorist 
Topic 19 Top Words:
     Highest Prob: film, one, like, movi, mugab, time, life 
     FREX: film, mugab, tsvangirai, mdc, mugabe’, solzhenitsyn, hartley 
     Lift: film, mugab, --brief, -beat, -femal, –’s, ‘controversial’ 
     Score: film, mugab, tsvangirai, mdc, movi, zimbabw, hartley 
Topic 20 Top Words:
     Highest Prob: will, american, america, countri, presid, nation, peopl 
     FREX: america, countri, togeth, proud, centuri, patriot, dream 
     Lift: --young, amar, antietam, borderland, century…, crosscurr, doughboy 
     Score: america, countri, presid, veteran, war, senat, that </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">findThoughts</span>(model1, <span class="at">texts =</span> meta<span class="sc">$</span>documents, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">topics =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 Topic 3: 
     A surge by&nbsp;Barack Obama has allowed him to leap&nbsp;&nbsp;ahead or pull&nbsp;even in several states he trailed badly in last week which means that it is likely neither he or Hillary Clinton will come out of Super Tuesday with a large lead in delegates.According to published polls and analysts in the know, Obama has an edge in Idaho, Colorado, Minnesota, Kansas, Alabama, Georgia, North Dakota and Illinois while Hillary Clinton is ahead in New York, New Jersey, Tennessee, New Mexico, Oklahoma and Arkansas.Up for grabs are&nbsp; California, Connecticut, Democrats Abroad, Arizona, Missouri, Delaware, Utah, American Samoa, Alaska, Massachusetts. Of those states, Hillary is ahead in Massachusetts with Obama closing while Obama has surged ahead in California but not by much. Clinton is also ahead in Connecticut and Missouri but by less than&nbsp;5 points.Obama has been surging in the national polls as well, drawing within the margin of era in most of the daily tracking polls. This could mean that a few of those toss up states may end up going to Obama.As far as delegate totals, most anaylsts expect only a 50-75 delegate edge to either candidate come Wednesday morning. And this could mean - probably means - that the Democratic race will be decided by Superdelegates; those 750&nbsp;elected officials who will be attending the convention and can pledge any candidate regardless of how their home state voted.Chris Bowers, a savvy Democratic strategists lays out the scenario:[Q]uick math shows that after Super Tuesday, only 1,428 pledged delegates will still be available. Now, here is where the problem shows up. According to current polling averages, the largest possible victory for either candidate on Super Tuesday will be Clinton 889 pledged delegates, to 799 pledged delegates for Obama. (In all likelihood, the winning margin will be lower than this, but using these numbers helps emphasize the seriousness of the situation.) As such, the largest possible pledged delegate margin Clinton can have after Super Tuesday is 937 to 862. (While it is possible Obama will lead in pledged delegates after Super Tuesday, it does not currently seem possible for Obama to have a larger lead than 75). That leaves Clinton 1,088 pledged delegates from clinching the nomination, with only 1,428 pledged delegates remaining. Thus, in order to win the nomination without the aid of super delegates, in her best-case scenario after Super Tuesday, Clinton would need to win 76.2% of all remaining pledged delegates. Given our proportional delegate system, there is simply no way that is going to happen unless Obama drops out.Clinton already has a large, unofficial lead in Superdelegates with at least 184 pledged to her candidacy already to Obama's 95. As the establishment candidate, Clinton can be expected to scoop up a large percentage of the remaining Supers - unless Obama can prove he would be a stronger candidate against McCain in the general election. In this case, both candidates poll within the margin of error against McCain so no advantage to either can be seen.A likely scenario would be the Clinton machine being able to rack up enough endorsements to put Hillary over the top within a couple of weeks of the last Democratic primary in June.
    A shocking new poll out today from Decision Analyst shows Barack Obama leading Hillary Clinton by double digits in the race for the Texas primary:Barack Obama has a double digit lead over Hillary Clinton in Texas, according to a statewide survey of 678 registered voters planning to vote in the March 4 Democratic Primary. The survey was conducted February 20 and 21 by Decision Analyst, a major national survey research firm. Decision Analyst projections indicate that if the election were held today Obama would win 57% to 43% over Clinton. The survey's margin of error is 3 percentage points, plus or minus, at a 90% level of confidence. For the Republican Primary, Decision Analyst projections indicate a John McCain win over Mike Huckabee 59% to 35%, with Ron Paul at 6%. These results are based on interviews with 399 registered voters planning to vote in the March 4 Republican Primary in Texas. The survey's margin of error is 4 percentage points, plus or minus, at a 90% level of confidence. The size sample may be smaller than is optimum but the poll reflects Obama's growing strength nationally in making inroads into Hillary Clinton's support. It appears that Hillary's "firewall" in Texas and Ohio are myths and that Obama may be heading for another big night on March 4.</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="fit-stm-model-2-with-covariates" class="level2">
<h2 class="anchored" data-anchor-id="fit-stm-model-2-with-covariates">Fit STM – Model 2 (With Covariates)</h2>
<div class="cell" data-hash="stm-explainer_cache/html/model2_0c44ce9c8ec44b1851db0e54afad8f57">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">stm</span>(<span class="at">documents =</span> docs,</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">vocab =</span> vocab,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">K =</span> <span class="dv">20</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">prevalence =</span> <span class="sc">~</span> rating <span class="sc">+</span> <span class="fu">s</span>(day, <span class="at">df =</span> <span class="dv">5</span>),</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> meta,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">init.type =</span> <span class="st">"Spectral"</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="explore-model-2" class="level3">
<h3 class="anchored" data-anchor-id="explore-model-2">Explore Model 2</h3>
<div class="cell" data-hash="stm-explainer_cache/html/model2-explore_bca65396935023afbe34874d740bff48">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model2, <span class="at">type =</span> <span class="st">"summary"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="stm-explainer_files/figure-html/model2-explore-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">labelTopics</span>(model2, <span class="at">topics =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Topic 3 Top Words:
     Highest Prob: obama, democrat, poll, hillari, voter, state, vote 
     FREX: superdeleg, deleg, primari, poll, pennsylvania, hampshir, michigan 
     Lift: “expanded”, bredesen, callupd, caucus-go, cfi, clintonsâ, enthus 
     Score: hillari, poll, obama, mccain, voter, clinton, deleg 
Topic 7 Top Words:
     Highest Prob: obama, barack, campaign, senat, clinton, said, will 
     FREX: blagojevich, barack, obama, illinoi, axelrod, blago, president-elect 
     Lift: bayh, blago, -payment, -watch, “appreciation”, “fg, “transformational” 
     Score: obama, barack, blagojevich, hillari, campaign, clinton, lieberman 
Topic 20 Top Words:
     Highest Prob: will, american, america, countri, presid, nation, peopl 
     FREX: america, countri, togeth, centuri, proud, veteran, dream 
     Lift: antietam, halsey, hispanic-american, pierr, qaida’, service-memb, --young 
     Score: america, countri, presid, veteran, war, senat, american </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">findThoughts</span>(model2, <span class="at">texts =</span> meta<span class="sc">$</span>documents, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">topics =</span> <span class="dv">3</span>)<span class="sc">$</span>docs[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "A shocking new poll out today from Decision Analyst shows Barack Obama leading Hillary Clinton by double digits in the race for the Texas primary:Barack Obama has a double digit lead over Hillary Clinton in Texas, according to a statewide survey of 678 registered voters planning to vote in the March 4 Democratic Primary. The survey was conducted February 20 and 21 by Decision Analyst, a major national survey research firm. Decision Analyst projections indicate that if the election were held today Obama would win 57% to 43% over Clinton. The survey's margin of error is 3 percentage points, plus or minus, at a 90% level of confidence. For the Republican Primary, Decision Analyst projections indicate a John McCain win over Mike Huckabee 59% to 35%, with Ron Paul at 6%. These results are based on interviews with 399 registered voters planning to vote in the March 4 Republican Primary in Texas. The survey's margin of error is 4 percentage points, plus or minus, at a 90% level of confidence. The size sample may be smaller than is optimum but the poll reflects Obama's growing strength nationally in making inroads into Hillary Clinton's support. It appears that Hillary's \"firewall\" in Texas and Ohio are myths and that Obama may be heading for another big night on March 4."                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
[2] "News from the polling front has Obama surging and Hillary Clinton reeling.A new CBS-New York Times poll has the Illinois senator vaulting to a double digit lead over Clinton:A new CBS News/New York Times poll finds Barack Obama with a 16-point lead over rival Hillary Clinton among Democratic primary voters nationwide. Obama, coming off 11 straight primary and caucus victories, had the support of 54 percent of Democratic primary voters nationally. Clinton had 38 percent support. In a CBS News poll taken three weeks ago, shortly before Super Tuesday, Obama and Clinton were tied at 41 percent. Clinton led by 15 points nationally in January. The former first lady has lost her advantage among women, according to the poll: The two leading Democrats now have even levels of support among female primary voters. Men, meanwhile, disproportionately favor Obama. He leads Clinton among male Democratic primary voters 67 percent to 28 percent, and leads among white men 61 percent to 33 percent. There it is in a nutshell. Hillary is barely holding her own among women while she is getting slaughtered among male voters. With gender numbers like that, her support among Hispanics and even senior citizens becomes irrelevant. Meanwhile, a week before the Texas and Ohio primaries, the race is even in the Lone Star State: In the CNN/Opinion Research Corp. survey released Monday, 50 percent of likely Democratic primary voters said Obama is their choice for the party's nominee, while 46 percent backed Clinton. But taking into account the poll's sampling error of plus or minus 3.5 percentage points for Democratic respondents, the race is a virtual tie. Clinton had a statistically insignificant 50 percent to 48 percent edge over Obama in last Monday's CNN/ORC poll in Texas. \"The 2-point gain for Obama and the 4-point drop for Clinton are both within the poll's sampling error, so although the survey appears to indicate some movement toward Obama, we cannot say for certain that he has gained any ground since last week,\" said CNN polling director Keating Holland. Two recent polls by other organizations also show the race statistically evenThe CBS-Times poll also shows 6 out of 10 Democrats believing that Obama has the best chance to beat John McCain next fall while a USA Today-Gallup poll show 7 out of 10 Democrats believing that Obama is the most electable.The Democratic party appears to have made up its mind. And unless some miraculous turnaround occurs, it appears that March 4 in Texas will indeed be Hillary Clinton's Alamo."</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="estimate-and-plot-covariate-effects" class="level2">
<h2 class="anchored" data-anchor-id="estimate-and-plot-covariate-effects">Estimate and Plot Covariate Effects</h2>
<div class="cell" data-hash="stm-explainer_cache/html/estimate-effect_0151396b4b3bbb12ba3af45a83deb395">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>effect_model <span class="ot">&lt;-</span> <span class="fu">estimateEffect</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span> <span class="sc">~</span> rating <span class="sc">+</span> <span class="fu">s</span>(day), model2,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                               <span class="at">meta =</span> meta, <span class="at">uncertainty =</span> <span class="st">"Global"</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(effect_model, <span class="at">topics =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
estimateEffect(formula = 1:20 ~ rating + s(day), stmobj = model2, 
    metadata = meta, uncertainty = "Global")


Topic 3:

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    0.154967   0.014165  10.940  &lt; 2e-16 ***
ratingLiberal  0.002271   0.003323   0.683  0.49438    
s(day)1       -0.014770   0.027837  -0.531  0.59570    
s(day)2       -0.079598   0.016168  -4.923 8.61e-07 ***
s(day)3       -0.060012   0.019785  -3.033  0.00242 ** 
s(day)4       -0.076890   0.016367  -4.698 2.65e-06 ***
s(day)5       -0.126273   0.018229  -6.927 4.50e-12 ***
s(day)6       -0.067179   0.016590  -4.049 5.17e-05 ***
s(day)7       -0.109046   0.017479  -6.239 4.54e-10 ***
s(day)8       -0.028207   0.020266  -1.392  0.16401    
s(day)9       -0.184102   0.021357  -8.620  &lt; 2e-16 ***
s(day)10      -0.106927   0.020955  -5.103 3.40e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="cell" data-hash="stm-explainer_cache/html/plot-time_efea33fa9ad7000df3007432f26f520d">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(effect_model, <span class="st">"day"</span>, <span class="at">method =</span> <span class="st">"continuous"</span>, <span class="at">topics =</span> <span class="dv">7</span>,</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">printlegend =</span> <span class="cn">FALSE</span>, <span class="at">xlab =</span> <span class="st">"Time (2008)"</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>monthseq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">as.Date</span>(<span class="st">"2008-01-01"</span>), <span class="at">to =</span> <span class="fu">as.Date</span>(<span class="st">"2008-12-01"</span>), <span class="at">by =</span> <span class="st">"month"</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>monthnames <span class="ot">&lt;-</span> <span class="fu">months</span>(monthseq)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="fu">as.numeric</span>(monthseq) <span class="sc">-</span> <span class="fu">min</span>(<span class="fu">as.numeric</span>(monthseq)), <span class="at">labels =</span> monthnames)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="stm-explainer_files/figure-html/plot-time-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="stm-explainer_cache/html/plot-rating-diff_b58b4ada31a13c371df58020a7e258a1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(effect_model, <span class="at">covariate =</span> <span class="st">"rating"</span>, <span class="at">topics =</span> <span class="dv">3</span>, <span class="at">method =</span> <span class="st">"difference"</span>,</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">cov.value1 =</span> <span class="st">"Liberal"</span>, <span class="at">cov.value2 =</span> <span class="st">"Conservative"</span>,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"More Liberal ... More Conservative"</span>,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Topic 3: Difference by Political Rating"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="stm-explainer_files/figure-html/plot-rating-diff-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<ul>
<li>STM helps uncover underlying topics in a collection of documents.</li>
<li>Document-level metadata can be used to model how topic proportions vary.</li>
<li>The logistic normal plays a similar role to a logit link in GLMs.</li>
<li>STM is hierarchical: topic use varies across documents; topics generate words.</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>